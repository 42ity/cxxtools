<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>tcpstream.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Erzeugt von Doxygen 1.2.9.1 -->
<center>
<a class="qindex" href="index.html">Hauptseite</a> &nbsp; <a class="qindex" href="hierarchy.html">Klassenhierarchie</a> &nbsp; <a class="qindex" href="annotated.html">Übersicht</a> &nbsp; <a class="qindex" href="files.html">Auflistung der Dateien</a> &nbsp; <a class="qindex" href="functions.html">Elementübersicht</a> &nbsp; </center>
<hr><h1>tcpstream.h</h1><div class="fragment"><pre>00001 
00002 <font class="comment">// tcpstream.h</font>
00003 <font class="comment">//</font>
00004 <font class="comment">// Author: Tommi Mäkitalo, Dr. Eckhardt + Partner GmbH</font>
00005 <font class="comment">//</font>
00006 <font class="preprocessor">#ifndef TCPSTREAM_H</font>
00007 <font class="preprocessor"></font><font class="preprocessor">#define TCPSTREAM_H</font>
00008 <font class="preprocessor"></font>
00009 <font class="preprocessor">#include &lt;iostream&gt;</font>
00010 <font class="preprocessor">#include &lt;string&gt;</font>
00011 <font class="preprocessor">#include &lt;stdexcept&gt;</font>
00012 
00013 <font class="keyword">namespace </font>tcp
00014 {
00016 
<a name="l00019"></a><a class="code" href="classtcp_1_1Exception.html">00019</a>   <font class="keyword">class </font>Exception : <font class="keyword">public</font> std::runtime_error
00020   {
00021     <font class="keyword">public</font>:
00024       <a class="code" href="classtcp_1_1Exception.html#a0">Exception</a>(<font class="keywordtype">int</font> Errno, <font class="keyword">const</font> std::string&amp; msg);
00027       <font class="keyword">explicit</font> <a class="code" href="classtcp_1_1Exception.html#a0">Exception</a>(<font class="keyword">const</font> std::string&amp; msg);
00028 
<a name="l00030"></a><a class="code" href="classtcp_1_1Exception.html#a2">00030</a>       <font class="keywordtype">int</font> <a class="code" href="classtcp_1_1Exception.html#a2">getErrno</a>()<font class="keyword"> const</font>
00031 <font class="keyword">      </font>{ <font class="keywordflow">return</font> m_Errno; }
00032 
00033     <font class="keyword">private</font>:
00034       <font class="keywordtype">int</font> m_Errno;
00035   };
00036 
00038 
<a name="l00041"></a><a class="code" href="classtcp_1_1eof.html">00041</a>   <font class="keyword">class </font>eof : <font class="keyword">public</font> std::exception
00042   {
00043     <font class="keyword">public</font>:
<a name="l00045"></a><a class="code" href="classtcp_1_1eof.html#a0">00045</a>       <a class="code" href="classtcp_1_1eof.html#a0">eof</a>()<font class="keyword">  </font>{ }
<a name="l00047"></a><a class="code" href="classtcp_1_1eof.html#a1">00047</a>       <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="classtcp_1_1eof.html#a1">what</a>() <font class="keyword">const</font> <font class="keywordflow">throw</font>()
00048       { <font class="keywordflow">return</font> <font class="stringliteral">"EOF"</font>; }
00049   };
00050 
00052 
<a name="l00055"></a><a class="code" href="classtcp_1_1Socket.html">00055</a>   <font class="keyword">class </font>Socket
00056   {
00057     <font class="keyword">public</font>:
00061       <a class="code" href="classtcp_1_1Socket.html#a0">Socket</a>(<font class="keywordtype">int</font> domain, <font class="keywordtype">int</font> type, <font class="keywordtype">int</font> protocol) <font class="keywordflow">throw</font> (Exception);
00062 
<a name="l00065"></a><a class="code" href="classtcp_1_1Socket.html#a1">00065</a>       <font class="keyword">explicit</font> <a class="code" href="classtcp_1_1Socket.html#a0">Socket</a>(<font class="keywordtype">int</font> fd = -1)
00066         : m_sockFd(fd)
00067         { }
00068 
00071       <font class="keyword">virtual</font> <a class="code" href="classtcp_1_1Socket.html#a2">~Socket</a>();
00072 
<a name="l00074"></a><a class="code" href="classtcp_1_1Socket.html#a3">00074</a>       <font class="keywordtype">bool</font> <a class="code" href="classtcp_1_1Socket.html#a3">good</a>()<font class="keyword"> const     </font>{ <font class="keywordflow">return</font> m_sockFd &gt;= 0; }
<a name="l00076"></a><a class="code" href="classtcp_1_1Socket.html#a4">00076</a>       <font class="keywordtype">bool</font> <a class="code" href="classtcp_1_1Socket.html#a4">bad</a>()<font class="keyword"> const      </font>{ <font class="keywordflow">return</font> m_sockFd &lt;  0; }
<a name="l00078"></a><a class="code" href="classtcp_1_1Socket.html#a5">00078</a>       <a class="code" href="classtcp_1_1Socket.html#a5">operator bool</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> m_sockFd &gt;= 0; }
00079 
00083       <font class="keywordtype">void</font> <a class="code" href="classtcp_1_1Socket.html#a6">create</a>(<font class="keywordtype">int</font> domain, <font class="keywordtype">int</font> type, <font class="keywordtype">int</font> protocol) <font class="keywordflow">throw</font> (Exception);
00085       <font class="keywordtype">void</font> <a class="code" href="classtcp_1_1Socket.html#a7">close</a>();
00086 
<a name="l00088"></a><a class="code" href="classtcp_1_1Socket.html#a8">00088</a>       <font class="keywordtype">int</font> <a class="code" href="classtcp_1_1Socket.html#a8">getFd</a>()<font class="keyword"> const     </font>{ <font class="keywordflow">return</font> m_sockFd; }
00089 
00090     <font class="keyword">private</font>:
00091       <font class="keywordtype">int</font>      m_sockFd;
00092 
00093       <a class="code" href="classtcp_1_1Socket.html#a0">Socket</a>(<font class="keyword">const</font> Socket&amp;);               <font class="comment">// no implementation</font>
00094       Socket&amp; operator= (<font class="keyword">const</font> Socket&amp;);   <font class="comment">// no implementation</font>
00095   };
00096 
00098 
<a name="l00101"></a><a class="code" href="classtcp_1_1Server.html">00101</a>   <font class="keyword">class </font>Server : <font class="keyword">public</font> Socket
00102   {
00103     <font class="keyword">public</font>:
00105       <font class="keyword">explicit</font> <a class="code" href="classtcp_1_1Server.html#a0">Server</a>(<font class="keywordtype">int</font> backlog = 5) <font class="keywordflow">throw</font> (Exception);
00107       <a class="code" href="classtcp_1_1Server.html#a0">Server</a>(<font class="keyword">const</font> std::string&amp; ipaddr, <font class="keywordtype">int</font> port, <font class="keywordtype">int</font> backlog = 5)
00108              <font class="keywordflow">throw</font> (Exception);
00110       <a class="code" href="classtcp_1_1Server.html#a0">Server</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* ipaddr, <font class="keywordtype">int</font> port, <font class="keywordtype">int</font> backlog = 5) <font class="keywordflow">throw</font> (Exception);
00111 
00112     <font class="keyword">private</font>:
00113       <font class="keywordtype">void</font> Listen(<font class="keywordtype">int</font> backlog) <font class="keywordflow">throw</font> (Exception);
00114       <font class="keywordtype">void</font> Listen(<font class="keyword">const</font> <font class="keywordtype">char</font>* ipaddr, <font class="keywordtype">int</font> port, <font class="keywordtype">int</font> backlog) <font class="keywordflow">throw</font> (Exception);
00115   };
00116 
00118 
<a name="l00124"></a><a class="code" href="classtcp_1_1Stream.html">00124</a>   <font class="keyword">class </font>Stream : <font class="keyword">public</font> Socket
00125   {
00126     <font class="keyword">public</font>:
00127       <font class="keyword">typedef</font> size_t size_type;
00128 
00130       <a class="code" href="classtcp_1_1Stream.html#a0">Stream</a>();
00132       <font class="keyword">explicit</font> <a class="code" href="classtcp_1_1Stream.html#a0">Stream</a>(<font class="keyword">const</font> Server&amp; server);
00136       <a class="code" href="classtcp_1_1Stream.html#a0">Stream</a>(<font class="keyword">const</font> std::string&amp; ipaddr, <font class="keywordtype">int</font> port);
00140       <a class="code" href="classtcp_1_1Stream.html#a0">Stream</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* ipaddr, <font class="keywordtype">int</font> port);
00141 
00144       <font class="keywordtype">void</font> <a class="code" href="classtcp_1_1Stream.html#a4">Connect</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* ipaddr, <font class="keywordtype">int</font> port);
<a name="l00147"></a><a class="code" href="classtcp_1_1Stream.html#a5">00147</a>       <font class="keywordtype">void</font> <a class="code" href="classtcp_1_1Stream.html#a4">Connect</a>(<font class="keyword">const</font> std::string&amp; ipaddr, <font class="keywordtype">int</font> port)<font class="keyword"></font>
00148 <font class="keyword">      </font>{ <a class="code" href="classtcp_1_1Stream.html#a4">Connect</a>(ipaddr.c_str(), port); }
00149 
00153       size_type <a class="code" href="classtcp_1_1Stream.html#a6">Read</a>(<font class="keywordtype">char</font>* buffer, size_type bufsize) <font class="keyword">const</font>;
00156       size_type <a class="code" href="classtcp_1_1Stream.html#a7">Write</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* buffer, size_type bufsize) <font class="keyword">const</font>;
00157 
00158     <font class="keyword">private</font>:
00159   };
00160 
00162 
<a name="l00168"></a><a class="code" href="classtcp_1_1streambuf.html">00168</a>         <font class="keyword">class </font>streambuf : <font class="keyword">public</font> std::streambuf
00169         {
00170 <font class="preprocessor">#if __GNUC__ &lt;= 2</font>
00171 <font class="preprocessor"></font>          <font class="keyword">typedef</font> <font class="keywordtype">int</font> int_type;
00172                 <font class="keyword">typedef</font> <font class="keywordtype">char</font> char_type;
00173 
00174                 <font class="keyword">class </font>traits_type
00175                 {
00176                         <font class="keyword">public</font>:
00177                           <font class="keyword">static</font> <font class="keywordtype">int</font> eof()<font class="keyword"></font>
00178 <font class="keyword">                                </font>{ <font class="keywordflow">return</font> EOF; }
00179                 };
00180 
00181 <font class="preprocessor">#endif</font>
00182 <font class="preprocessor"></font>
00183                 <font class="keyword">public</font>:
00185       <font class="keyword">explicit</font> <a class="code" href="classtcp_1_1streambuf.html#a0">streambuf</a>(Stream&amp; stream, <font class="keywordtype">unsigned</font> bufsize = 256);
00186 
<a name="l00188"></a><a class="code" href="classtcp_1_1streambuf.html#a1">00188</a>       <a class="code" href="classtcp_1_1streambuf.html#a1">~streambuf</a>()<font class="keyword"></font>
00189 <font class="keyword">                        </font>{ <font class="keyword">delete</font> m_buffer; }
00190 
00192                         int_type <a class="code" href="classtcp_1_1streambuf.html#a2">overflow</a>(int_type c);
00194                         int_type <a class="code" href="classtcp_1_1streambuf.html#a3">underflow</a>();
00196                         <font class="keywordtype">int</font> <a class="code" href="classtcp_1_1streambuf.html#a4">sync</a>();
00197 
00198                 <font class="keyword">private</font>:
00199                   Stream&amp;    m_stream;
00200                         <font class="keywordtype">unsigned</font>   m_bufsize;
00201                         char_type* m_buffer;
00202         };
00203 
00205 
<a name="l00208"></a><a class="code" href="classtcp_1_1iostream.html">00208</a>   <font class="keyword">class </font>iostream : <font class="keyword">public</font> std::iostream, <font class="keyword">public</font> Stream
00209   {
00210     <font class="keyword">public</font>:
<a name="l00212"></a><a class="code" href="classtcp_1_1iostream.html#a0">00212</a>       <font class="keyword">explicit</font> <a class="code" href="classtcp_1_1iostream.html#a0">iostream</a>(<font class="keywordtype">unsigned</font> bufsize = 256)
00213         : std::iostream(&amp;m_buffer),
00214           m_buffer(*this, bufsize)
00215                                 { }
00216 
<a name="l00218"></a><a class="code" href="classtcp_1_1iostream.html#a1">00218</a>       <font class="keyword">explicit</font> <a class="code" href="classtcp_1_1iostream.html#a0">iostream</a>(<font class="keyword">const</font> Server&amp; server, <font class="keywordtype">unsigned</font> bufsize = 256)
00219         : std::iostream(&amp;m_buffer),
00220           Stream(server),
00221           m_buffer(*this, bufsize)
00222                                 { }
00223 
<a name="l00225"></a><a class="code" href="classtcp_1_1iostream.html#a2">00225</a>       <a class="code" href="classtcp_1_1iostream.html#a0">iostream</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* ipaddr, <font class="keywordtype">int</font> port, <font class="keywordtype">unsigned</font> bufsize = 256)
00226         : std::iostream(&amp;m_buffer),
00227           Stream(ipaddr, port),
00228           m_buffer(*this, bufsize)
00229                                 { }
00230 
<a name="l00232"></a><a class="code" href="classtcp_1_1iostream.html#a3">00232</a>       <a class="code" href="classtcp_1_1iostream.html#a0">iostream</a>(std::string ipaddr, <font class="keywordtype">int</font> port, <font class="keywordtype">unsigned</font> bufsize = 256)
00233         : std::iostream(&amp;m_buffer),
00234           Stream(ipaddr, port),
00235           m_buffer(*this, bufsize)
00236         { }
00237 
00238     <font class="keyword">private</font>:
00239       streambuf m_buffer;
00240   };
00241 
00242 } <font class="comment">// namespace tcp</font>
00243 
00244 <font class="preprocessor">#endif // TCPSTREAM_H</font>
</font></pre></div><hr><address><small>Erzeugt am Thu May 30 22:54:12 2002 für C++Utilities von
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.9.1 geschrieben von <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
